<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–û–Ω–±–æ—Ä–¥–∏–Ω–≥: –°–∫–∞—É—Ç | –ö–∞—Ä–µ—Ç–∞ –ú–æ–±–∏–ª–∏—Ç–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* --- –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò --- */
        :root { 
            --bg: #ffffff; 
            --text: #000; 
            --yellow: #FFED00; 
            --black: #000; 
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            padding: 15px; 
            text-align: center; 
            margin: 0; 
            overflow-x: hidden; 
            -webkit-font-smoothing: antialiased; 
        }
        
        /* --- –≠–ö–†–ê–ù–´ --- */
        .screen { 
            display: none; 
            background: #fff; 
            padding: 20px; 
            border-radius: 24px; 
            margin-top: 10px; 
            border: 3px solid var(--yellow); 
            animation: fadeIn 0.4s cubic-bezier(0.165, 0.84, 0.44, 1); 
            box-shadow: 0 10px 25px rgba(0,0,0,0.08); 
        }
        
        .screen.center { 
            text-align: center; 
        }
        
        .active { 
            display: block; 
        }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        /* --- –¢–ò–ü–û–ì–†–ê–§–ò–ö–ê --- */
        h2 { 
            text-transform: uppercase; 
            font-size: 22px; 
            margin-bottom: 10px; 
            letter-spacing: 0.5px; 
            color: var(--black); 
            font-weight: 800; 
            line-height: 1.2; 
        }
        
        p { 
            color: #555; 
            font-size: 15px; 
            line-height: 1.4; 
            margin-bottom: 20px; 
            font-weight: 500; 
        }
        
        /* --- –§–û–†–ú–´ –ò –ö–ù–û–ü–ö–ò --- */
        input { 
            width: 100%; 
            padding: 16px; 
            margin-top: 10px; 
            border: 3px solid var(--yellow); 
            border-radius: 14px; 
            font-size: 18px; 
            box-sizing: border-box; 
            text-align: center; 
            font-weight: bold; 
            outline: none; 
            transition: 0.3s; 
            background: #fafafa; 
        }
        
        input:focus { 
            border-color: var(--black); 
            background: #fff; 
        }
        
        button { 
            background: var(--yellow); 
            color: #000; 
            border: none; 
            padding: 18px; 
            border-radius: 14px; 
            font-size: 18px; 
            font-weight: 800; 
            width: 100%; 
            margin-top: 20px; 
            text-transform: uppercase; 
            box-shadow: 0 5px 0 #d4c300; 
            cursor: pointer; 
            transition: transform 0.1s, box-shadow 0.1s; 
            display: block; 
        }
        
        button:active { 
            transform: translateY(3px); 
            box-shadow: 0 2px 0 #d4c300; 
        }
        
        button:disabled { 
            background: #e0e0e0 !important; 
            color: #a0a0a0 !important; 
            box-shadow: none !important; 
            cursor: not-allowed; 
            transform: none; 
        }
        
        .logo-main { 
            width: 120px; 
            height: auto; 
            margin-bottom: 20px; 
            border-radius: 20px; 
            box-shadow: 0 8px 20px rgba(0,0,0,0.1); 
        }
        
        /* --- –ú–ï–ù–Æ --- */
        .format-btn { 
            background: #fff; 
            border: 3px solid var(--yellow); 
            color: #000; 
            margin-bottom: 12px; 
            padding: 18px; 
            text-align: left; 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            box-shadow: 0 6px 0 #f0f0f0; 
            transition: 0.2s; 
        }
        
        .format-btn:active { 
            transform: translateY(3px); 
            box-shadow: 0 3px 0 #f0f0f0; 
        }
        
        .format-icon { 
            font-size: 28px; 
            margin-right: 15px; 
        }
        
        .format-info div:first-child { 
            font-weight: 800; 
            font-size: 17px; 
            text-transform: uppercase; 
        }
        
        .format-info div:last-child { 
            font-size: 13px; 
            color: #666; 
            margin-top: 4px; 
        }
        
        .pdf-btn { 
            background: #fff; 
            border: 3px solid #e74c3c; 
            color: #e74c3c; 
        }
        
        /* --- –ú–ï–î–ò–ê (–í–ò–î–ï–û/–ê–£–î–ò–û) --- */
        .media-container { 
            position: relative; 
            border-radius: 16px; 
            overflow: hidden; 
            border: 2px solid var(--yellow); 
            background: #000; 
            margin-bottom: 15px; 
        }
        
        .video-wrapper { 
            position: relative; 
            padding-bottom: 56.25%; 
            height: 0; 
        }
        
        .video-wrapper iframe { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
        }
        
        /* --- TINDER –ö–ê–†–¢–û–ß–ö–ò --- */
        .tinder-container { 
            position: relative; 
            height: 65vh; 
            min-height: 500px; 
            max-height: 700px; 
            width: 100%; 
            margin-top: 10px; 
            perspective: 1000px; 
        }
        
        .tinder-card { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: #fff; 
            border: 3px solid var(--yellow); 
            border-radius: 20px; 
            overflow: hidden; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.1); 
            transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1), opacity 0.4s; 
            display: flex; 
            flex-direction: column; 
            text-align: left; 
        }
        
        .tinder-card.swiped-left { 
            transform: translateX(-200%) rotate(-30deg) !important; 
            opacity: 0; 
        }
        
        .tinder-card.swiped-right { 
            transform: translateX(200%) rotate(30deg) !important; 
            opacity: 0; 
        }
        
        .card-img { 
            width: 100%; 
            height: 50%; 
            object-fit: cover; 
            border-bottom: 3px solid var(--yellow); 
            background: #f0f0f0; 
            flex-shrink: 0; 
        }
        
        .card-text { 
            padding: 15px 20px; 
            font-size: 15px; 
            line-height: 1.5; 
            flex-grow: 1; 
            background: #fff; 
            display: block; 
            overflow-y: auto; 
            text-align: left; 
            font-weight: 500; 
        }
        
        .card-text::-webkit-scrollbar { width: 6px; }
        .card-text::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .card-text::-webkit-scrollbar-thumb { background: #ccc; border-radius: 10px; }
        
        .swipe-hint { 
            font-size: 13px; 
            color: #999; 
            margin-top: 10px; 
            animation: pulse 2s infinite; 
            font-weight: 600; 
        }
        
        @keyframes pulse { 
            0% { opacity: 0.6; } 
            50% { opacity: 1; } 
            100% { opacity: 0.6; } 
        }

        /* --- –ö–í–ò–ó --- */
        .option { 
            display: flex; 
            align-items: center; 
            padding: 15px; 
            background: #f4f4f4; 
            margin-bottom: 10px; 
            border-radius: 14px; 
            cursor: pointer; 
            text-align: left; 
            border: 2px solid transparent; 
            font-weight: 700; 
            font-size: 15px; 
            transition: 0.2s; 
            -webkit-tap-highlight-color: transparent; 
        }
        
        .option:active { 
            background: #ececec; 
            transform: scale(0.98); 
        }
        
        .status-bar { 
            display: flex; 
            justify-content: space-between; 
            font-weight: 800; 
            background: var(--yellow); 
            padding: 12px 20px; 
            border-radius: 14px; 
            margin-bottom: 15px; 
            box-shadow: 0 4px 0 #d4c300; 
            font-size: 14px; 
        }
        
        .info-box {
            background: #e3f2fd; 
            padding: 15px; 
            border-radius: 12px; 
            margin-bottom: 15px; 
            font-size: 14px; 
            border: 2px solid #2196f3;
            text-align: left;
            line-height: 1.4;
        }
        
        .reset-btn {
            background: transparent;
            color: #999;
            border: none;
            box-shadow: none;
            margin-top: 25px;
            font-size: 14px;
            text-decoration: underline;
        }
    </style>
</head>
<body>

    <div id="statusBar" class="status-bar" style="display: none;">
        <span>–í–û–ü–†–û–°: <span id="q-counter">1/15</span></span>
        <span>üí∞ <span id="coins">0</span></span>
    </div>

    <div id="screen-reg" class="screen center">
        <img src="logo.jpg" class="logo-main" alt="–ö–∞—Ä–µ—Ç–∞ –ú–æ–±–∏–ª–∏—Ç–∏" onerror="this.src='https://via.placeholder.com/150?text=LOGO'">
        <h2>–ü—Ä–∏–≤–µ—Ç, –°–∫–∞—É—Ç! üö¥‚Äç‚ôÇÔ∏è</h2>
        <p>–ó–∞–ø–æ–ª–Ω–∏ –∞–Ω–∫–µ—Ç—É (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).</p>
        
        <input type="text" id="user-name" placeholder="–§–ò–û" oninput="validateForm()">
        <input type="tel" id="user-phone" value="+7 " maxlength="18" oninput="validateForm()">
        <input type="text" id="user-birth" placeholder="–î–î.–ú–ú.–ì–ì–ì–ì" oninput="formatDate(this); validateForm()" maxlength="10">
        <input type="text" id="user-city" placeholder="–ì–æ—Ä–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –†–æ—Å—Ç–æ–≤)" oninput="validateForm()">
        
        <button id="btn-start" disabled onclick="saveAndGo()">–î–∞–ª–µ–µ</button>
    </div>

    <div id="screen-formats" class="screen">
        <h2>–§–æ—Ä–º–∞—Ç –æ–±—É—á–µ–Ω–∏—è</h2>
        
        <div class="info-box">
            ‚ö†Ô∏è <b>–í–Ω–∏–º–∞–Ω–∏–µ:</b> –î–ª—è –¥–æ–ø—É—Å–∫–∞ –∫ —Ç–µ—Å—Ç—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–∑—É—á–∏—Ç—å <b>–≤—Å–µ</b> —Ñ–æ—Ä–º–∞—Ç—ã –æ–±—É—á–µ–Ω–∏—è. –°–æ–±–µ—Ä–∏ –≤—Å–µ 4 –∑–µ–ª–µ–Ω—ã–µ –≥–∞–ª–æ—á–∫–∏, —á—Ç–æ–±—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É.
        </div>
        
        <button class="format-btn" onclick="startCards()">
            <div class="format-info">
                <div>üìñ –ö–∞—Ä—Ç–æ—á–∫–∏</div>
                <div>–°–≤–∞–π–ø–∞–π —Ç–µ–∫—Å—Ç —Å —Ñ–æ—Ç–æ</div>
            </div>
            <div class="format-icon" id="icon-cards">‚ö™</div>
        </button>
        
        <button class="format-btn" onclick="startVideo()">
            <div class="format-info">
                <div>üì∫ –í–∏–¥–µ–æ</div>
                <div>–°–º–æ—Ç—Ä–µ—Ç—å –æ–±–∑–æ—Ä</div>
            </div>
            <div class="format-icon" id="icon-video">‚ö™</div>
        </button>
        
        <button class="format-btn" onclick="startAudio()">
            <div class="format-info">
                <div>üéß –ü–æ–¥–∫–∞—Å—Ç</div>
                <div>–°–ª—É—à–∞—Ç—å –≤ —Ñ–æ–Ω–µ</div>
            </div>
            <div class="format-icon" id="icon-audio">‚ö™</div>
        </button>
        
        <button class="format-btn pdf-btn" onclick="openPDF()">
            <div class="format-info">
                <div style="color:#e74c3c">üìë –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è</div>
                <div style="color:#e74c3c">–°–∫–∞—á–∞—Ç—å –∏ —á–∏—Ç–∞—Ç—å</div>
            </div>
            <div class="format-icon" id="icon-pdf">‚ö™</div>
        </button>
        
        <button id="btn-main-test" disabled style="margin-top: 30px;" onclick="startQuiz()">–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç üîí</button>
        
        <button class="reset-btn" onclick="resetApp()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
    </div>

    <div id="screen-theory-cards" class="screen center">
        <h2>–ü—Ä–∞–≤–∏–ª–∞</h2>
        <div class="swipe-hint">–õ–∏—Å—Ç–∞–π —Ç–µ–∫—Å—Ç ‚¨áÔ∏è, —Å–º–∞—Ö–∏–≤–∞–π ‚û°Ô∏è (–î–∞–ª—å—à–µ) –∏–ª–∏ ‚¨ÖÔ∏è (–ù–∞–∑–∞–¥)</div>
        <div class="tinder-container" id="tinder-deck"></div>
        
        <button id="btn-cards-finish" style="display:none; background:#2ecc71; color:white; box-shadow:0 5px 0 #27ae60;" onclick="markCompleted('cards')">‚úÖ –û—Ç–ª–∏—á–Ω–æ! –í –º–µ–Ω—é</button>
        <button style="background:transparent; color:#999; border:none; box-shadow:none; margin-top:10px; font-size:14px;" onclick="showFormats()">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
    </div>

    <div id="screen-theory-video" class="screen center">
        <h2>–í–∏–¥–µ–æ–æ–±–∑–æ—Ä</h2>
        <div class="media-container">
            <div class="video-wrapper">
                <iframe id="onboarding-video" src="https://rutube.ru/play/embed/900cde7cfae7ff125a6a7da1d8d9ce96/?p=x-I4ULg0MU6OYQodDqvM4Q" frameBorder="0" allow="autoplay; fullscreen"></iframe>
            </div>
        </div>
        
        <button style="background:#2ecc71; color:white; box-shadow:0 5px 0 #27ae60;" onclick="markCompleted('video')">‚úÖ –Ø –ø–æ—Å–º–æ—Ç—Ä–µ–ª</button>
        <button style="background:#fff; color:#000; border:2px solid #eee; margin-top:10px; font-size:14px; box-shadow:none;" onclick="showFormats()">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
    </div>

    <div id="screen-theory-audio" class="screen center">
        <h2>–ü–æ–¥–∫–∞—Å—Ç</h2>
        <div style="background:#f4f4f4; padding:30px; border-radius:20px; margin-bottom:20px;">
            <div style="font-size:50px; margin-bottom:10px;">üéß</div>
            <p style="margin-bottom:15px; font-weight:bold;">–°–ª—É—à–∞–π –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ</p>
            <audio id="onboarding-audio" controls style="width: 100%; border-radius: 50px;">
                <source src="podcast.m4a" type="audio/mp4">
            </audio>
        </div>
        
        <button style="background:#2ecc71; color:white; box-shadow:0 5px 0 #27ae60;" onclick="markCompleted('audio')">‚úÖ –Ø –ø—Ä–æ—Å–ª—É—à–∞–ª</button>
        <button style="background:#fff; color:#000; border:2px solid #eee; margin-top:10px; font-size:14px; box-shadow:none;" onclick="showFormats()">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
    </div>

    <div id="screen-theory-pdf" class="screen center">
        <h2>–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è</h2>
        <div style="background:#f4f4f4; padding:30px; border-radius:20px; margin-bottom:20px;">
            <div style="font-size:50px; margin-bottom:10px;">üìÑ</div>
            <p style="margin-bottom:15px; font-weight:bold; font-size: 16px;">–û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª, –∏–∑—É—á–∏ –ø—Ä–∞–≤–∏–ª–∞, –∞ –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ.</p>
            <button style="background:#e74c3c; color:#fff; box-shadow:0 5px 0 #c0392b; margin-top: 10px;" onclick="window.open('presentation.pdf', '_blank')">üì• –ß–∏—Ç–∞—Ç—å PDF</button>
        </div>
        
        <button style="background:#2ecc71; color:white; box-shadow:0 5px 0 #27ae60;" onclick="markCompleted('pdf')">‚úÖ –Ø –ø—Ä–æ—á–∏—Ç–∞–ª</button>
        <button style="background:#fff; color:#000; border:2px solid #eee; margin-top:10px; font-size:14px; box-shadow:none;" onclick="showFormats()">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
    </div>

    <div id="screen-quiz" class="screen">
        <h3 id="q-text" style="font-size: 19px; line-height: 1.4; margin-bottom: 20px; font-weight: 800;"></h3>
        <div id="options-box"></div>
    </div>

    <div id="screen-finish" class="screen center">
        <img src="logo.jpg" class="logo-main" alt="–£—Å–ø–µ—Ö" onerror="this.src='https://via.placeholder.com/150?text=WIN'">
        <h2 id="finish-title">–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
        <p id="res-info" style="font-size:18px; font-weight:bold; color:#000; margin-bottom: 15px;"></p>
        
        <div style="background:var(--yellow); padding:20px; border-radius: 18px; margin: 20px 0; box-shadow: 0 6px 0 #d4c300;" id="coin-box">
            <p style="margin:0; font-size: 14px; font-weight: bold; color: #555; text-transform: uppercase;">–ò—Ç–æ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –º–æ–Ω–µ—Ç:</p>
            <h3 style="margin:5px 0 0 0; font-size: 38px; font-weight: 900;">üí∞ <span id="res-coins">0</span></h3>
        </div>
        
        <p id="send-status" style="font-weight: bold; font-size: 16px;"></p>
        
        <button id="btn-close" disabled onclick="tg.close()" style="display:none; background:#2ecc71; box-shadow: 0 6px 0 #27ae60; color:white;">–ó–∞–∫—Ä—ã—Ç—å –æ–±—É—á–µ–Ω–∏–µ</button>
        <button id="btn-retry" onclick="showFormats()" style="display:none; background:#e74c3c; box-shadow: 0 6px 0 #c0392b; color:white;">–ù–∞ –ø–µ—Ä–µ—Å–¥–∞—á—É</button>
    </div>

    <script>
        const GOOGLE_URL = "https://script.google.com/macros/s/AKfycbxAOyN8XERwNRQRqd80VQOQOXGnujqTpqprFyTMIxa8RM-JzWYA6SYtYTnTKf_AKfAc/exec";
        
        let tg = window.Telegram.WebApp;
        tg.expand();

        let userData = { name: "", phone: "", city: "", birth: "", score: 0, coins: 0 };
        let currentQ = 0;
        const TOTAL_QUESTIONS = 15;
        let progress = { cards: false, video: false, audio: false, pdf: false };

        // –¢–ï–û–†–ò–Ø –ö–ê–†–¢–û–ß–ï–ö
        const theory = [
            { t: "<b>üëî 1. –°–¢–ê–ù–î–ê–†–¢ –°–ï–†–í–ò–°–ê</b><br><br>–ú—ã ‚Äî –ø—Ä–µ–º–∏—É–º –±—Ä–µ–Ω–¥. –¢–≤–æ–π –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –ª–∏—Ü–æ –∫–æ–º–ø–∞–Ω–∏–∏.<br><br><b>–ü—Ä–∞–≤–∏–ª–∞:</b><br>‚Ä¢ –ó–∞–ø—Ä–µ—â–µ–Ω–æ –∫—É—Ä–∏—Ç—å, –µ—Å—Ç—å –∏–ª–∏ –ø–∏—Ç—å, –Ω–∞—Ö–æ–¥—è—Å—å –Ω–∞ –ö–∞—Ä–µ—Ç–µ.<br>‚Ä¢ –§–æ—Ä–º–∞ (–ø–æ–ª–æ, –∫–µ–ø–∫–∞) –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å—Ç–æ–π –∏ –æ–ø—Ä—è—Ç–Ω–æ–π.<br>‚Ä¢ –û–±—â–∞–π—Å—è —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –≤–µ–∂–ª–∏–≤–æ –∏ —Å —É–ª—ã–±–∫–æ–π.<br>‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π —á–∏—Å—Ç–æ—Ç—É —Ç–µ—Ö–Ω–∏–∫–∏. –ü—ã–ª—å –Ω–∞ —Å–∏–¥–µ–Ω—å—è—Ö –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–∞.", img: "1.jpg" }, 
            { t: "<b>üÖøÔ∏è 2. –ò–î–ï–ê–õ–¨–ù–ê–Ø –ü–ê–†–ö–û–í–ö–ê</b><br><br>–ü–∞—Ä–∫–æ–≤–∫–∞ ‚Äî —ç—Ç–æ –Ω–∞—à–∞ –≤–∏—Ç—Ä–∏–Ω–∞. –ö–∞–∫ —Å—Ç–æ—è—Ç –ö–∞—Ä–µ—Ç—ã, —Ç–∞–∫ –ª—é–¥–∏ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—é—Ç –Ω–∞—à —Å–µ—Ä–≤–∏—Å.<br><br><b>–ü—Ä–∞–≤–∏–ª–∞:</b><br>‚Ä¢ –°—Ç–∞–≤—å –ö–∞—Ä–µ—Ç—ã —Å—Ç—Ä–æ–≥–æ –≤ –æ–¥–Ω—É —Ä–æ–≤–Ω—É—é –ª–∏–Ω–∏—é.<br>‚Ä¢ –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –Ω–∏–º–∏ ‚Äî —Ä–æ–≤–Ω–æ <b>50 —Å–º</b>.<br>‚Ä¢ –†—É–ª—å –∏ —Ñ–∞—Ä—ã –¥–æ–ª–∂–Ω—ã —Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç—Ä–æ–≥–æ –ø—Ä—è–º–æ.<br>‚Ä¢ –¢–µ—Ö–Ω–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ —Å–∏—è—Ç—å, –Ω–∏–∫–∞–∫–∏—Ö –ø–µ—Ä–µ–∫–æ—Å–æ–≤ –Ω–∞ —Å—Ç–∞–Ω—Ü–∏–∏.", img: "2.png" }, 
            { t: "<b>‚öñÔ∏è 3. –ë–ê–õ–ê–ù–° –ü–ê–†–ö–û–í–ö–ò</b><br><br>–¢–µ—Ö–Ω–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ç–∞–º, –≥–¥–µ –æ–Ω–∞ –Ω—É–∂–Ω–∞ –ª—é–¥—è–º. –ù–µ —Å–æ–∑–¥–∞–≤–∞–π –ø—É—Å—Ç—ã—Ö —Ç–æ—á–µ–∫ –∏–ª–∏ ¬´—Å–≤–∞–ª–æ–∫¬ª –∏–∑ –∫–∞—Ä–µ—Ç.<br><br><b>–¢–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è:</b><br>‚Ä¢ –ú–Ω–æ–≥–æ –∫–∞—Ä–µ—Ç –Ω–∞ —Ç–æ—á–∫–µ? –£–≥–æ–Ω–∏ –ª–∏—à–Ω–∏–µ –Ω–∞ —Å–æ—Å–µ–¥–Ω—é—é –ø—É—Å—Ç—É—é.<br>‚Ä¢ –¢–æ—á–∫–∞ –æ–ø—É—Å—Ç–µ–ª–∞? –ë—ã—Å—Ç—Ä–æ –ø—Ä–∏–≥–æ–Ω–∏ —Ç–µ—Ö–Ω–∏–∫—É.<br>‚Ä¢ –ö–ª–∏–µ–Ω—Ç—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –∂–¥–∞—Ç—å –≤ –æ—á–µ—Ä–µ–¥–∏ –∏–∑-–∑–∞ –ø–ª–æ—Ö–æ–π –ª–æ–≥–∏—Å—Ç–∏–∫–∏.", img: "3.jpg" }, 
            { t: "<b>ü§ù 4. –¢–´ ‚Äî –≠–ö–°–ü–ï–†–¢</b><br><br>–î–ª—è —Ç—É—Ä–∏—Å—Ç–∞ —Ç—ã ‚Äî –≥–ª–∞–≤–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ –ø–∞—Ä–∫–µ. –ë—É–¥—å –≥–æ—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å —Å —É–ª—ã–±–∫–æ–π.<br><br><b>–ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å:</b><br>‚Ä¢ –í—Å–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã –∏ –ø—Ä–∞–≤–∏–ª–∞ –∞—Ä–µ–Ω–¥—ã.<br>‚Ä¢ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–ø–æ–º–æ–≥–∏ —Å–∫–∞—á–∞—Ç—å, –ø—Ä–∏–≤—è–∑–∞—Ç—å –∫–∞—Ä—Ç—É).<br>‚Ä¢ –ö—É–¥–∞ –ª—É—á—à–µ –ø–æ–µ—Ö–∞—Ç—å (–º–∞—Ä—à—Ä—É—Ç—ã –∏ –∫—Ä–∞—Å–∏–≤—ã–µ –º–µ—Å—Ç–∞).", img: "4.png" }, 
            { t: "<b>üì± 5. –ó–ê–†–ü–õ–ê–¢–ê –ò –°–ú–ï–ù–ê</b><br><br>–í—Å—ë —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–º–µ–Ω–æ–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å—Ç—Ä–æ–≥–æ —á–µ—Ä–µ–∑ –Ω–∞—à–µ–≥–æ Telegram-–±–æ—Ç–∞.<br><br><b>–ê–ª–≥–æ—Ä–∏—Ç–º:</b><br>‚Ä¢ –ü—Ä–∏—à–µ–ª –Ω–∞ —Ç–æ—á–∫—É -> –Ω–∞–∂–∞–ª ¬´–°—Ç–∞—Ä—Ç —Å–º–µ–Ω—ã¬ª.<br>‚Ä¢ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–¥–µ–ª–∞–π <b>—Å–µ–ª—Ñ–∏ –≤ —Ñ–∏—Ä–º–µ–Ω–Ω–æ–π —Ñ–æ—Ä–º–µ</b> –Ω–∞ —Ñ–æ–Ω–µ –ø–∞—Ä–∫–æ–≤–∫–∏.<br>‚Ä¢ –ù–µ—Ç –æ—Ç–º–µ—Ç–∫–∏ –≤ –±–æ—Ç–µ = –Ω–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã. –ë–æ—Ç —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Ç–≤–æ–µ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è.", img: "5.png" }, 
            { t: "<b>üõ† 6. –†–ê–ë–û–ß–ò–ô –ò–ù–í–ï–ù–¢–ê–†–¨</b><br><br>–¢—ã –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å –±—ã—Å—Ç—Ä–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ö–∞—Ä–µ—Ç—É –∫ –ø–æ–µ–∑–¥–∫–µ. –í–µ—Å—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –ª–µ–∂–∏—Ç –≤ –ø–∏–ª–æ–Ω–µ –Ω–∞ –ø–∞—Ä–∫–æ–≤–∫–µ –∏–ª–∏ –Ω–∞ —Å–∫–ª–∞–¥–µ.<br><br><b>–¢–≤–æ–π –Ω–∞–±–æ—Ä:</b><br>‚Ä¢ –ì–∞–µ—á–Ω—ã–µ –∫–ª—é—á–∏ –Ω–∞ 13 –∏ 15, –æ—Ç–≤–µ—Ä—Ç–∫–∞.<br>‚Ä¢ –ü–ª–∞—Å—Ç–∏–∫–æ–≤—ã–µ —Å—Ç—è–∂–∫–∏.<br>‚Ä¢ –Ø—Ä–∫–∞—è –º–∏–∫—Ä–æ—Ñ–∏–±—Ä–∞ –¥–ª—è –ø—Ä–æ—Ç–∏—Ä–∫–∏.<br>‚Ä¢ –ñ–µ—Å—Ç–∫–∞—è —â–µ—Ç–∫–∞ –¥–ª—è —Å—á–∏—Å—Ç–∫–∏ –ø–µ—Å–∫–∞ —Å —Ä–∞–º—ã.", img: "6.png" }, 
            { t: "<b>üîß 7. –ü–û–õ–û–ú–ö–ò –ò –†–ï–ú–û–ù–¢</b><br><br>–¢–µ—Ö–Ω–∏–∫–∞ –∏–Ω–æ–≥–¥–∞ –ª–æ–º–∞–µ—Ç—Å—è. –ì–ª–∞–≤–Ω–æ–µ ‚Äî –±—ã—Å—Ç—Ä–æ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å—Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å.<br><br><b>–¢–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è:</b><br>‚Ä¢ –ú–µ–ª–∫–∏–π —Ä–µ–º–æ–Ω—Ç (–ø–æ–¥–∫—Ä—É—Ç–∏—Ç—å –±–æ–ª—Ç) ‚Äî –¥–µ–ª–∞–π —Å–∞–º –Ω–∞ –º–µ—Å—Ç–µ.<br>‚Ä¢ –°–µ—Ä—å–µ–∑–Ω–∞—è –ø–æ–ª–æ–º–∫–∞ (—Ç—Ä–µ—â–∏–Ω–∞ –≤ —Ä–∞–º–µ, —Å–ø—É—Å—Ç–∏–ª–æ –∫–æ–ª–µ—Å–æ) ‚Äî –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ <b>–ø–∏—à–∏ –∑–∞—è–≤–∫—É –≤ –±–æ—Ç</b>.<br>‚Ä¢ –°–ª–æ–º–∞–Ω–Ω—É—é –ö–∞—Ä–µ—Ç—É –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–º–∏ —Å –ª–∏–Ω–∏–∏.", img: "7.png" }, 
            { t: "<b>üéß 8. –ê–£–î–ò–û–ì–ò–î</b><br><br>–ê—É–¥–∏–æ–≥–∏–¥ ‚Äî —ç—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω–∞—è —Ñ–∏—à–∫–∞ –Ω–∞—à–∏—Ö –ö–∞—Ä–µ—Ç, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–≤—ã—à–∞–µ—Ç –ª–æ—è–ª—å–Ω–æ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤.<br><br><b>–ü—Ä–∞–≤–∏–ª–∞:</b><br>‚Ä¢ –¶–µ–Ω–∞ —É—Å–ª—É–≥–∏ ‚Äî –≤—Å–µ–≥–æ <b>1 —Ä—É–±–ª—å</b>.<br>‚Ä¢ –¢—ã –æ–±—è–∑–∞–Ω –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –∞—É–¥–∏–æ–≥–∏–¥ –∞–±—Å–æ–ª—é—Ç–Ω–æ <b>–∫–∞–∂–¥–æ–º—É</b> –∫–ª–∏–µ–Ω—Ç—É –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º –ø–æ–µ–∑–¥–∫–∏.<br>‚Ä¢ –ü–æ–º–æ–≥–∏ —Ç—É—Ä–∏—Å—Ç–∞–º –≤–∫–ª—é—á–∏—Ç—å –∏ –Ω–∞–¥–µ—Ç—å –Ω–∞—É—à–Ω–∏–∫–∏.", img: "8.png" }
        ];

        window.addEventListener('DOMContentLoaded', () => {
            let savedName = localStorage.getItem('scoutName');
            let savedPhone = localStorage.getItem('scoutPhone');
            let savedCity = localStorage.getItem('scoutCity');
            let savedBirth = localStorage.getItem('scoutBirth');

            if (savedName && savedPhone && savedName.length > 1) {
                userData.name = savedName;
                userData.phone = savedPhone;
                userData.city = savedCity || "";
                userData.birth = savedBirth || "";
                
                document.getElementById('user-name').value = savedName;
                document.getElementById('user-phone').value = savedPhone;
                document.getElementById('user-city').value = savedCity || "";
                document.getElementById('user-birth').value = savedBirth || "";
                
                showFormats();
            } else {
                document.getElementById('screen-reg').classList.add('active');
            }
        });

        // –§–£–ù–ö–¶–ò–Ø –°–ë–†–û–°–ê –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
        function resetApp() {
            if (confirm("–¢–æ—á–Ω–æ —Ö–æ—á–µ—à—å —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ?")) {
                localStorage.clear();
                location.reload();
            }
        }

        function formatDate(input) {
            let v = input.value.replace(/\D/g, ''); 
            if (v.length > 2) v = v.slice(0, 2) + '.' + v.slice(2);
            if (v.length > 5) v = v.slice(0, 5) + '.' + v.slice(5, 9);
            input.value = v;
        }

        function validateForm() {
            let n = document.getElementById('user-name').value.trim();
            let c = document.getElementById('user-city').value.trim();
            let b = document.getElementById('user-birth').value.trim();
            let p = document.getElementById('user-phone');
            
            let digits = p.value.replace(/\D/g, '');
            if (digits.startsWith('7') || digits.startsWith('8')) {
                digits = digits.substring(1);
            }
            p.value = digits.length > 0 ? '+7' + digits : '+7'; 
            
            let isValid = (n.length > 2 && c.length > 2 && b.length === 10 && digits.length >= 10);
            document.getElementById('btn-start').disabled = !isValid;
        }

        function saveAndGo() {
            userData.name = document.getElementById('user-name').value;
            userData.phone = document.getElementById('user-phone').value;
            userData.city = document.getElementById('user-city').value;
            userData.birth = document.getElementById('user-birth').value;
            
            localStorage.setItem('scoutName', userData.name);
            localStorage.setItem('scoutPhone', userData.phone);
            localStorage.setItem('scoutCity', userData.city);
            localStorage.setItem('scoutBirth', userData.birth);
            
            showFormats();
        }

        function stopMedia() {
            let audio = document.getElementById('onboarding-audio');
            if (audio) { audio.pause(); audio.currentTime = 0; }
            let video = document.getElementById('onboarding-video');
            if (video) { let currentSrc = video.src; video.src = ''; video.src = currentSrc; }
        }

        function showFormats() { stopMedia(); showScreen('screen-formats'); }
        function startVideo() { showScreen('screen-theory-video'); }
        function startAudio() { showScreen('screen-theory-audio'); }
        function openPDF() { showScreen('screen-theory-pdf'); }
        
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function markCompleted(format) {
            stopMedia(); 
            progress[format] = true;
            document.getElementById(`icon-${format}`).innerText = '‚úÖ';
            
            if (progress.cards && progress.video && progress.audio && progress.pdf) {
                let btnTest = document.getElementById('btn-main-test');
                btnTest.disabled = false;
                btnTest.innerText = '–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç üîì';
            }
            
            showFormats();
            tg.HapticFeedback.notificationOccurred('success');
        }

        // --- –õ–û–ì–ò–ö–ê –ö–ê–†–¢–û–ß–ï–ö ---
        let currentCardIndex = 0;
        let maxCardIndex = 0;

        function startCards() {
            showScreen('screen-theory-cards');
            currentCardIndex = 0;
            maxCardIndex = 0;
            document.getElementById('btn-cards-finish').style.display = 'none';
            document.querySelector('.swipe-hint').style.display = 'block';
            renderCurrentCard();
        }

        function renderCurrentCard() {
            const deck = document.getElementById('tinder-deck');
            deck.innerHTML = ''; 

            let item = theory[currentCardIndex];
            let card = document.createElement('div');
            card.className = 'tinder-card';
            
            let fallbackImg = item.img.includes('.jpg') ? item.img.replace('.jpg', '.png') : item.img.replace('.png', '.jpg');
            let fallbackImgJpeg = item.img.includes('.jpg') ? item.img.replace('.jpg', '.jpeg') : item.img.replace('.png', '.jpeg');
            
            card.innerHTML = `
                <div style="position:absolute; top:12px; right:12px; font-weight:900; color:#000; background:var(--yellow); padding:5px 12px; border-radius:10px; z-index:10; font-size:14px; box-shadow: 0 4px 10px rgba(0,0,0,0.2);">
                    ${currentCardIndex + 1} / ${theory.length}
                </div>
                <img src="${item.img}" class="card-img" onerror="this.onerror=null; this.src='${fallbackImg}'; this.onerror=function(){this.onerror=null; this.src='${fallbackImgJpeg}';};">
                <div class="card-text">${item.t}</div>
            `;
            
            deck.appendChild(card);
            setupSwipe(card);

            if (maxCardIndex >= theory.length - 1) {
                document.getElementById('btn-cards-finish').style.display = 'block';
                document.querySelector('.swipe-hint').style.display = 'none';
            } else {
                document.getElementById('btn-cards-finish').style.display = 'none';
                document.querySelector('.swipe-hint').style.display = 'block';
            }
        }

        function setupSwipe(card) {
            let startX = 0; 
            let startY = 0;
            let isDragging = false;
            let isScrolling = false;
            
            card.ontouchstart = e => { 
                startX = e.touches[0].clientX; 
                startY = e.touches[0].clientY;
                isDragging = true; 
                isScrolling = false;
                card.style.transition = 'none'; 
            };
            
            card.ontouchmove = e => { 
                if (!isDragging) return; 
                
                let diffX = e.touches[0].clientX - startX; 
                let diffY = e.touches[0].clientY - startY;
                
                if (!isScrolling && Math.abs(diffY) > Math.abs(diffX)) {
                    isScrolling = true;
                    isDragging = false;
                    card.style.transform = 'translate(0)'; 
                    return; 
                }
                
                if (isScrolling) return;

                card.style.transform = `translateX(${diffX}px) rotate(${diffX/25}deg)`; 
            };
            
            card.ontouchend = e => {
                if (isScrolling) { isScrolling = false; return; }
                
                isDragging = false; 
                card.style.transition = 'transform 0.4s cubic-bezier(0.23, 1, 0.32, 1)';
                
                let diffX = e.changedTouches[0].clientX - startX;
                
                if (diffX > 100) {
                    if (currentCardIndex < theory.length - 1) {
                        tg.HapticFeedback.impactOccurred('medium');
                        card.classList.add('swiped-right'); 
                        currentCardIndex++;
                        maxCardIndex = Math.max(maxCardIndex, currentCardIndex);
                        setTimeout(() => renderCurrentCard(), 300);
                    } else {
                        card.style.transform = 'translate(0)';
                        tg.HapticFeedback.notificationOccurred('warning');
                    }
                } 
                else if (diffX < -100) {
                    if (currentCardIndex > 0) {
                        tg.HapticFeedback.impactOccurred('medium');
                        card.classList.add('swiped-left'); 
                        currentCardIndex--;
                        setTimeout(() => renderCurrentCard(), 300);
                    } else {
                        card.style.transform = 'translate(0)';
                        tg.HapticFeedback.notificationOccurred('warning');
                    }
                } 
                else {
                    card.style.transform = 'translate(0)';
                }
            };
        }

        // --- –í–û–ü–†–û–°–´ –î–õ–Ø –¢–ï–°–¢–ê ---
        let questions = [
            { q: "–ö–∞–∫ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ç–≤–æ–µ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è?", a: ["–ó–∞–ø–∏—Å—ã–≤–∞—é –≤ –±–ª–æ–∫–Ω–æ—Ç", "–ß–µ—Ä–µ–∑ Telegram-–±–æ—Ç (–≥–µ–æ–ª–æ–∫–∞—Ü–∏—è)", "–ì–æ–≤–æ—Ä—é –¢–ú –Ω–∞ —Å–ª–æ–≤–∞—Ö"], c: 1, p: true },
            { q: "–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–º–µ–Ω—ã –≤ –±–æ—Ç–µ?", a: ["–ü—Ä–æ—Å—Ç–æ –Ω–∞–∂–∞—Ç—å —Å—Ç–∞—Ä—Ç", "–°–¥–µ–ª–∞—Ç—å —Å–µ–ª—Ñ–∏ –≤ —Ñ–æ—Ä–º–µ –Ω–∞ —Ñ–æ–Ω–µ –ö–∞—Ä–µ—Ç", "–ù–∞–ø–∏—Å–∞—Ç—å '–Ø —Ç—É—Ç' –≤ —á–∞—Ç"], c: 1, p: true },
            { q: "–ì–¥–µ –∏—Å–∫–∞—Ç—å –∫–ª—é—á–∏ –∏ —Ç—Ä—è–ø–∫–∏?", a: ["–ù–æ—à—É –∏–∑ –¥–æ–º–∞", "–í –ø–∏–ª–æ–Ω–µ –Ω–∞ –ø–∞—Ä–∫–æ–≤–∫–µ –∏–ª–∏ –Ω–∞ —Å–∫–ª–∞–¥–µ", "–ü–æ–∫—É–ø–∞—é —Å–∞–º"], c: 1, p: true },
            { q: "–ó–∞—á–µ–º –Ω—É–∂–Ω–∞ –∂–µ—Å—Ç–∫–∞—è —â–µ—Ç–∫–∞?", a: ["–î–ª—è –≤–æ–ª–æ—Å", "–°—á–∏—â–∞—Ç—å –ø–µ—Å–æ–∫ –∏ –∑–µ–º–ª—é —Å —Ä–∞–º—ã", "–î–ª—è –æ–¥–µ–∂–¥—ã"], c: 1, p: true },
            { q: "–ù–∞ —Ç–≤–æ–µ–π —Ç–æ—á–∫–µ 0 –∫–∞—Ä–µ—Ç, –Ω–∞ —Å–æ—Å–µ–¥–Ω–µ–π ‚Äî 10 (–ø–µ—Ä–µ–±–æ—Ä). –¢–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è?", a: ["–ñ–¥–∞—Ç—å, –ø–æ–∫–∞ –ø—Ä–∏–≤–µ–∑—É—Ç", "–ü—Ä–∏–≥–Ω–∞—Ç—å –ª–∏—à–Ω–∏–µ —Å —Å–æ—Å–µ–¥–Ω–µ–π –∫ —Å–µ–±–µ", "–ò–¥—Ç–∏ –¥–æ–º–æ–π"], c: 1, p: true },
            { q: "–ö–∞–∫–∏–µ –∫–ª—é—á–∏ –Ω—É–∂–Ω—ã –¥–ª—è –º–µ–ª–∫–æ–≥–æ —Ä–µ–º–æ–Ω—Ç–∞?", a: ["–ù–∞ 10 –∏ 12", "–ù–∞ 13 –∏ 15", "–†–∞–∑–≤–æ–¥–Ω–æ–π –∫–ª—é—á"], c: 1, p: true },
            { q: "–ö–ª–∏–µ–Ω—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ –≥—Ä—É–∑–æ–ø–æ–¥—ä–µ–º–Ω–æ—Å—Ç—å. –ß—Ç–æ –æ—Ç–≤–µ—Ç–∏—à—å?", a: ["–ù–µ –∑–Ω–∞—é, —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏", "–ù–∞–∑–æ–≤—É —Ç–æ—á–Ω—É—é —Ü–∏—Ñ—Ä—É –∏ –ø–æ–º–æ–≥—É", "–≠—Ç–æ —Å–µ–∫—Ä–µ—Ç"], c: 1, p: true },
            { q: "–î–∏—Å—Ç–∞–Ω—Ü–∏—è –º–µ–∂–¥—É –ö–∞—Ä–µ—Ç–∞–º–∏?", a: ["–í–ø–ª–æ—Ç–Ω—É—é", "–†–æ–≤–Ω–æ 50 —Å–º", "1 –º–µ—Ç—Ä"], c: 1, p: true },
            { q: "–ú–æ–∂–Ω–æ –ª–∏ –∫—É—Ä–∏—Ç—å –≤ –ö–∞—Ä–µ—Ç–µ?", a: ["–î–∞", "–ö–∞—Ç–µ–≥–æ—Ä–∏—á–µ—Å–∫–∏ –∑–∞–ø—Ä–µ—â–µ–Ω–æ", "–ï—Å–ª–∏ –Ω–µ—Ç –ª—é–¥–µ–π"], c: 1, p: true },
            { q: "–°–ª–æ–º–∞–ª–∞—Å—å —Ä–∞–º–∞ (—Ç—Ä–µ—â–∏–Ω–∞). –¢–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è?", a: ["–ß–∏–Ω–∏—Ç—å —Å–∫–æ—Ç—á–µ–º", "–ó–∞—è–≤–∫–∞ –≤ –±–æ—Ç + —Å–æ–æ–±—â–∏—Ç—å –¢–ú", "–°–∫—Ä—ã—Ç—å –ø–æ–ª–æ–º–∫—É"], c: 1, p: true },
            { q: "–¶–µ–Ω–∞ –∞—É–¥–∏–æ–≥–∏–¥–∞?", a: ["–ë–µ—Å–ø–ª–∞—Ç–Ω–æ", "1 —Ä—É–±–ª—å", "500 —Ä—É–±–ª–µ–π"], c: 1, p: false },
            { q: "–ü—Ä–∞–≤–∏–ª–æ —á–∏—Å—Ç–æ—Ç—ã ‚Äî —ç—Ç–æ...", a: ["–¢–æ–ª—å–∫–æ —Å–∏–¥–µ–Ω—å—è", "–°–±–∏—Ç—å –ø—ã–ª—å", "–°–∏–¥–µ–Ω—å—è, —Ä–∞–º–∞, –∫–æ–ª–µ—Å–∞ –¥–æ –±–ª–µ—Å–∫–∞"], c: 2, p: true },
            { q: "–§–∏—Ä–º–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞ ‚Äî —ç—Ç–æ...", a: ["–ü–æ –∂–µ–ª–∞–Ω–∏—é", "–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ", "–¢–æ–ª—å–∫–æ –≤ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏"], c: 1, p: false },
            { q: "–ö–∞–∫ –ø–µ—Ä–µ–≥–æ–Ω—è—Ç—å –ö–∞—Ä–µ—Ç—É?", a: ["–ì—Ä—è–∑–Ω–æ–π", "–ß–∏—Å—Ç–æ–π", "–ë—ã—Å—Ç—Ä–æ"], c: 0, p: true },
            { q: "–ö–ª–∏–µ–Ω—Ç –≥—Ä—É–±–∏—Ç, –Ω–æ —Ö–æ—á–µ—Ç –µ—Ö–∞—Ç—å. –¢–≤–æ—è —Ä–µ–∞–∫—Ü–∏—è?", a: ["–ì—Ä—É–±–∏—Ç—å –≤ –æ—Ç–≤–µ—Ç", "–í–µ–∂–ª–∏–≤–æ –ø–æ–º–æ—á—å –∏ –æ–±—ä—è—Å–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞", "–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å"], c: 1, p: true }
        ];

        function startQuiz() {
            userData.score = 0; 
            userData.coins = 0; 
            currentQ = 0;
            questions.sort(() => Math.random() - 0.5);
            showScreen('screen-quiz');
            document.getElementById('statusBar').style.display = 'flex';
            renderQ();
        }

        function renderQ() {
            let q = questions[currentQ];
            document.getElementById('q-counter').innerText = `${currentQ+1}/${TOTAL_QUESTIONS}`;
            document.getElementById('q-text').innerText = q.q;
            document.getElementById('options-box').innerHTML = q.a.map((opt, i) => `<div class="option" onclick="handleAns(${i})">${opt}</div>`).join('');
        }

        function handleAns(idx) {
            if (idx === questions[currentQ].c) { 
                userData.score++; 
                if (questions[currentQ].p) { userData.coins += 100; }
                tg.HapticFeedback.notificationOccurred('success'); 
            } else { tg.HapticFeedback.notificationOccurred('error'); }
            
            currentQ++;
            if (currentQ < TOTAL_QUESTIONS) { renderQ(); } else { showFinish(); }
        }

        function showFinish() {
            showScreen('screen-finish');
            document.getElementById('statusBar').style.display = 'none';
            document.getElementById('res-info').innerText = userData.name;
            
            if (userData.score < 12) {
                document.getElementById('finish-title').innerText = "–¢–µ—Å—Ç –Ω–µ —Å–¥–∞–Ω ‚ùå";
                document.getElementById('send-status').innerText = `–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 12 –∏–∑ 15 (—É —Ç–µ–±—è ${userData.score})`;
                document.getElementById('send-status').style.color = "#e74c3c";
                document.getElementById('coin-box').style.display = "none";
                document.getElementById('btn-close').style.display = "none";
                document.getElementById('btn-retry').style.display = "block";
            } else {
                document.getElementById('res-coins').innerText = userData.coins;
                document.getElementById('finish-title').innerText = "–≠–∫–∑–∞–º–µ–Ω —Å–¥–∞–Ω! ‚úÖ";
                document.getElementById('send-status').innerText = "–û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...";
                document.getElementById('send-status').style.color = "#2ecc71";
                document.getElementById('coin-box').style.display = "block";
                document.getElementById('btn-close').style.display = "block";
                document.getElementById('btn-retry').style.display = "none";
                
                const payload = JSON.stringify({
                    name: userData.name, 
                    phone: userData.phone,
                    city: userData.city,
                    birth: userData.birth,
                    role: "–°–∫–∞—É—Ç",
                    score: userData.score, 
                    coins: userData.coins,
                    tg_user: tg.initDataUnsafe.user ? tg.initDataUnsafe.user.username : "—Å–∫—Ä—ã—Ç"
                });

                fetch(GOOGLE_URL, {
                    method: "POST",
                    mode: "no-cors",
                    headers: { "Content-Type": "text/plain" },
                    body: payload
                }).then(() => {
                    document.getElementById('send-status').innerText = "‚úÖ –î–ê–ù–ù–´–ï –í –¢–ê–ë–õ–ò–¶–ï!";
                    document.getElementById('btn-close').disabled = false;
                }).catch(err => {
                    document.getElementById('send-status').innerText = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏, —Å–∫—Ä–∏–Ω—à–æ—Ç—å —ç–∫—Ä–∞–Ω!";
                    console.error(err);
                });
            }
        }
    </script>
</body>
</html>
